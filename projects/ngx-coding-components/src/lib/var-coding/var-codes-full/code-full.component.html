<div *ngIf="code" class="fx-row-start-stretch fx-gap-5" [style.max-height.px]="300">
  <div class="fx-column-start-stretch" [style.width.%]="50">
    <code-header (codeDataChanged)="setCodeChanged()" [enableSwitchNull]="true"
                 [code]="code" [allCodes]="allCodes"></code-header>
    <mat-card class="fx-flex-fill" [style.padding-left.px]="4">
      <mat-card-subtitle>{{'code.prompt-auto-coding' | translate}}</mat-card-subtitle>
      <mat-card-content class="fx-row-start-center fx-flex-fill">
        <div *ngFor="let rule of firstRuleSet?.rules" class="fx-row-start-center fx-flex-fill"
             (mouseover)="showCodeButtonsOf=rule.method" (mouseout)="showCodeButtonsOf=''">
          <div class="fx-column-start-stretch fx-flex-fill">
            <div [matTooltip]="('rule.' + rule.method + '.description') | translate"
                 matTooltipShowDelay="500">
              {{('rule.' + rule.method) | translate}}</div>
            <mat-form-field *ngIf="getParamCountWrapper(rule.method) < 0">
              <textarea matInput *ngIf="rule.parameters"
                        [(ngModel)]="rule.parameters[0]"
                        (ngModelChange)="setCodeChanged()"
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="2"
                        cdkAutosizeMaxRows="8"></textarea>
            </mat-form-field>
            <mat-form-field *ngIf="getParamCountWrapper(rule.method) > 0">
              <input matInput *ngIf="rule.parameters"
                     [(ngModel)]="rule.parameters[0]"
                     (ngModelChange)="setCodeChanged()">
            </mat-form-field>
            <mat-form-field *ngIf="getParamCountWrapper(rule.method) > 1">
              <input matInput *ngIf="rule.parameters"
                     [(ngModel)]="rule.parameters[1]"
                     (ngModelChange)="setCodeChanged()">
            </mat-form-field>
          </div>
          <button mat-icon-button [matTooltip]="'rule.prompt.delete' | translate" (click)="deleteRule(rule.method)"
                  [class]="showCodeButtonsOf === rule.method ? 'buttonDisplay' : 'buttonHide'">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        <div class="fx-row-space-between-center">
          <button mat-icon-button [matMenuTriggerFor]="menu" *ngIf="getNewRules().length > 0"
                  [matTooltip]="'rule.prompt.add' | translate">
            <mat-icon>add</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item *ngFor="let newSource of getNewRules()" (click)="addRule(newSource)">
              {{('rule.' + newSource) | translate}}
            </button>
          </mat-menu>
          <div *ngIf="firstRuleSet && firstRuleSet.rules.length === 0" [matMenuTriggerFor]="menu"
               class="no-rules">{{'rule.no-rules' | translate}}</div>
          <div class="fx-column-start-stretch" *ngIf="firstRuleSet && firstRuleSet.rules.length > 1">
            <label>{{"rule.prompt.operator" | translate }}</label>
            <mat-radio-group [(ngModel)]="firstRuleSet.ruleOperatorAnd"
                             (ngModelChange)="setCodeChanged()"
                             class="fx-row-space-between-center">
              <mat-radio-button [value]="false">{{"rule.operator.false" | translate }}</mat-radio-button>
              <mat-radio-button [value]="true">{{"rule.operator.true" | translate }}</mat-radio-button>
            </mat-radio-group>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <code-instruction [code]="code" (codeDataChanged)="setCodeChanged()" [style.flex]="'1 1 auto'"></code-instruction>
</div>
