<div *ngIf="code" class="fx-row-start-stretch fx-gap-5">
  <div class="fx-column-start-stretch fx-flex-fill">
    <div class="code-main-data fx-row-start-center">
      <mat-form-field [class]="uniqueNumberValidator(code.id) ? 'unique-id' : 'not-unique-id'" [style.width.px]="80">
        <mat-label>{{'code.id' | translate}}</mat-label>
        <input matInput
               required
               [(ngModel)]="code.id"
               (ngModelChange)="setCodeChanged()"
               type="number">
      </mat-form-field>
      <mat-form-field
        *ngIf="maxScore > 1"
        [class]="code.score > 0 ? 'correct' : 'not-correct'"
        [style.width.px]="100">
        <mat-label>{{'code.score' | translate}}</mat-label>
        <input matInput
               type="number"
               required
               [(ngModel)]="code.score"
               (ngModelChange)="setCodeChanged()">
      </mat-form-field>
      <mat-form-field class="fx-flex-fill">
        <mat-label>{{'code.description' | translate}}</mat-label>
        <input matInput
               [placeholder]="'code.description' | translate"
               [(ngModel)]="code.label"
               (ngModelChange)="setCodeChanged()">
      </mat-form-field>
    </div>
    <div class="fx-row-start-start fx-flex-fill">
      <div class="has-rules-warning">
        <p *ngIf="code.manualInstruction"
           matTooltip="Es gibt Instruktionen für das manuelle Kodieren, die unnötig sind (automatische Kodierung eindeutig).">!!</p>
      </div>
      <mat-card class="fx-flex-fill" [style.padding-left.px]="4">
        <mat-card-subtitle>{{'code.prompt-auto-coding' | translate}}</mat-card-subtitle>
        <mat-card-content class="fx-row-start-center fx-flex-fill">
          <div *ngFor="let rule of firstRuleSet?.rules" class="fx-row-start-center fx-flex-fill"
               (mouseover)="showCodeButtonsOf=rule.method" (mouseout)="showCodeButtonsOf=''">
            <div class="fx-column-start-stretch fx-flex-fill">
              <div [matTooltip]="('rule.' + rule.method + '.description') | translate"
                   matTooltipShowDelay="500">
                {{('rule.' + rule.method) | translate}}</div>
              <mat-form-field *ngIf="getParamCountWrapper(rule.method) < 0">
              <textarea matInput *ngIf="rule.parameters"
                        [(ngModel)]="rule.parameters[0]"
                        (ngModelChange)="setCodeChanged()"
                        cdkTextareaAutosize
                        cdkAutosizeMinRows="2"
                        cdkAutosizeMaxRows="8"></textarea>
              </mat-form-field>
              <mat-form-field *ngIf="getParamCountWrapper(rule.method) > 0">
                <input matInput *ngIf="rule.parameters"
                       [(ngModel)]="rule.parameters[0]"
                       (ngModelChange)="setCodeChanged()">
              </mat-form-field>
              <mat-form-field *ngIf="getParamCountWrapper(rule.method) > 1">
                <input matInput *ngIf="rule.parameters"
                       [(ngModel)]="rule.parameters[1]"
                       (ngModelChange)="setCodeChanged()">
              </mat-form-field>
            </div>
            <button mat-icon-button [matTooltip]="'rule.prompt.delete' | translate" (click)="deleteRule(rule.method)"
                    *ngIf="singletonRules.indexOf(rule.method) < 0"
                    [class]="showCodeButtonsOf === rule.method ? 'buttonDisplay' : 'buttonHide'">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          <div class="fx-row-start-center">
            <button mat-icon-button [matMenuTriggerFor]="menu" *ngIf="getNewRules().length > 0"
                    [matTooltip]="'rule.prompt.add' | translate">
              <mat-icon>add</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item *ngFor="let newSource of getNewRules()" (click)="addRule(newSource)">
                {{('rule.' + newSource) | translate}}
              </button>
            </mat-menu>
            <div *ngIf="firstRuleSet && firstRuleSet.rules.length === 0" [matMenuTriggerFor]="menu"
                 class="no-rules">{{'rule.no-rules' | translate}}</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
